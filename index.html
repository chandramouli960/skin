<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Goal Tracker - Groups & Progress</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœ¨</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Wait for Supabase to load, then initialize
        window.addEventListener('load', function() {
            const SUPABASE_URL = 'https://gjuqohgorthzgcitjrqh.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqdXFvaGdvcnRoemdjaXRqcnFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MTkzNjAsImV4cCI6MjA4MDA5NTM2MH0.iEQOiTn-T3uClSYkoV5EvNXaEkMbYwBhbzGiGxCPB1o';
            
            // Initialize Supabase client
            if (typeof supabase !== 'undefined') {
                window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            } else {
                console.error('Supabase library not loaded');
            }
        });
    </script>
</head>
<body>
    <!-- Login/Register Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-container">
            <h2>Welcome to Goal Tracker</h2>
            <p class="auth-subtitle">Track goals, join groups, and achieve together!</p>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h3>Login</h3>
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
                <p class="auth-switch">Don't have an account? <a href="#" id="showRegister">Register</a></p>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <h3>Create Account</h3>
                <form id="registerFormElement">
                    <div class="form-group">
                        <label for="registerName">Name</label>
                        <input type="text" id="registerName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" name="password" required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary">Register</button>
                </form>
                <p class="auth-switch">Already have an account? <a href="#" id="showLogin">Login</a></p>
            </div>
        </div>
    </div>

    <!-- Main App (hidden until logged in) -->
    <div id="mainApp" style="display: none;">
        <!-- Mobile Overlay -->
        <div id="dashboardOverlay" class="dashboard-overlay"></div>
        
        <!-- Left Dashboard Sidebar -->
        <aside class="dashboard-sidebar">
            <div class="dashboard-header">
                <h2>Dashboard</h2>
            </div>
            <div class="dashboard-tabs">
                <button class="dashboard-tab active" data-dashboard="friendsDashboard">
                    <span class="dashboard-tab-icon">ðŸ’¬</span>
                    <span>Friends</span>
                </button>
                <button class="dashboard-tab" data-dashboard="groupsDashboard">
                    <span class="dashboard-tab-icon">ðŸ‘¥</span>
                    <span>Groups</span>
                </button>
                <button class="dashboard-tab" data-dashboard="goalsDashboard">
                    <span class="dashboard-tab-icon">ðŸŽ¯</span>
                    <span>My Goals</span>
                </button>
            </div>
            <div class="dashboard-content">
                <!-- Friends Dashboard -->
                <div id="friendsDashboard" class="dashboard-panel active">
                    <div class="dashboard-panel-header">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <h3>Friends</h3>
                            <span id="friendRequestsBadge" class="notification-badge" style="display: none;">0</span>
                        </div>
                        <div style="display: flex; gap: 6px;">
                            <button id="sidebarFriendRequestsBtn" class="btn-icon-small" title="Friend Requests">ðŸ“¬</button>
                            <button id="sidebarAddFriendBtn" class="btn-icon-small" title="Add Friend">+</button>
                        </div>
                    </div>
                    <div id="sidebarFriendsList" class="dashboard-list">
                        <p class="loading">Loading friends...</p>
                    </div>
                </div>
                <!-- Groups Dashboard -->
                <div id="groupsDashboard" class="dashboard-panel">
                    <div class="dashboard-panel-header">
                        <h3>Groups</h3>
                    </div>
                    <div id="sidebarGroupsList" class="dashboard-list">
                        <p class="loading">Loading groups...</p>
                    </div>
                </div>
                <!-- Goals Dashboard -->
                <div id="goalsDashboard" class="dashboard-panel">
                    <div class="dashboard-panel-header">
                        <h3>My Goals</h3>
                    </div>
                    <div id="sidebarGoalsList" class="dashboard-list">
                        <p class="loading">Loading goals...</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Top Header -->
        <header class="app-header">
            <div class="header-top">
                <h1>Goal Tracker</h1>
                <div class="header-actions">
                    <button id="createGroupBtn" class="btn-icon" title="Create Group">+</button>
                    <button id="logoutBtn" class="btn-icon" title="Logout">ðŸ‘¤</button>
                </div>
            </div>
            <div class="user-info-header">
                <span id="userName"></span>
            </div>
            <!-- Desktop Navigation -->
            <nav class="desktop-nav">
                <button class="desktop-nav-item active" data-tab="groupsTab">
                    <span class="desktop-nav-icon">ðŸ‘¥</span>
                    <span>Groups</span>
                </button>
                <button class="desktop-nav-item" data-tab="goalsTab">
                    <span class="desktop-nav-icon">ðŸŽ¯</span>
                    <span>Goals</span>
                </button>
                <button class="desktop-nav-item" data-tab="progressTab">
                    <span class="desktop-nav-icon">ðŸ“Š</span>
                    <span>Progress</span>
                </button>
                <button class="desktop-nav-item" data-tab="friendsTab">
                    <span class="desktop-nav-icon">ðŸ’¬</span>
                    <span>Friends</span>
                </button>
            </nav>
        </header>

        <!-- Main Content Area -->
        <main class="app-main with-sidebar">
            <!-- Groups Tab -->
            <div id="groupsTab" class="tab-content active">
                <div class="section-header">
                    <h2>My Groups</h2>
                    <button id="joinGroupBtn" class="btn btn-secondary btn-small">Join Group</button>
                </div>
                <div id="groupsList" class="cards-list">
                    <p class="loading">Loading groups...</p>
                </div>
            </div>

            <!-- Goals Tab -->
            <div id="goalsTab" class="tab-content">
                <div class="section-header">
                    <h2>My Goals</h2>
                    <button id="createGoalBtn" class="btn btn-primary btn-small">+ New Goal</button>
                </div>
                <div id="goalsList" class="cards-list">
                    <p class="loading">Loading goals...</p>
                </div>
            </div>

            <!-- Progress Tab -->
            <div id="progressTab" class="tab-content">
                <div class="section-header">
                    <h2>Recent Progress</h2>
                </div>
                <div id="progressList" class="cards-list">
                    <p class="loading">Loading progress...</p>
                </div>
            </div>

            <!-- Friends Tab -->
            <div id="friendsTab" class="tab-content">
                <div class="section-header">
                    <h2>Friends</h2>
                    <div style="display: flex; gap: 10px;">
                        <button id="friendRequestsBtn" class="btn btn-secondary btn-small">Requests</button>
                        <button id="addFriendBtn" class="btn btn-primary btn-small">+ Add Friend</button>
                    </div>
                </div>
                <div id="friendsList" class="cards-list">
                    <p class="loading">Loading friends...</p>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-tab="groupsTab">
                <span class="nav-icon">ðŸ‘¥</span>
                <span class="nav-label">Groups</span>
            </button>
            <button class="nav-item" data-tab="goalsTab">
                <span class="nav-icon">ðŸŽ¯</span>
                <span class="nav-label">Goals</span>
            </button>
            <button class="nav-item" data-tab="progressTab">
                <span class="nav-icon">ðŸ“Š</span>
                <span class="nav-label">Progress</span>
            </button>
            <button class="nav-item" data-tab="friendsTab">
                <span class="nav-icon">ðŸ’¬</span>
                <span class="nav-label">Friends</span>
            </button>
        </nav>

        <!-- Status Message -->
        <div id="statusMessage" class="status-message"></div>
    </div>

    <!-- Modals -->
    
    <!-- Create Group Modal -->
    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Group</h3>
                <button class="modal-close" data-modal="createGroupModal">&times;</button>
            </div>
            <form id="createGroupForm">
                <div class="form-group">
                    <label for="groupName">Group Name</label>
                    <input type="text" id="groupName" required>
                </div>
                <div class="form-group">
                    <label for="groupDescription">Description</label>
                    <textarea id="groupDescription" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Create Group</button>
            </form>
        </div>
    </div>

    <!-- Join Group Modal -->
    <div id="joinGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Join Group</h3>
                <button class="modal-close" data-modal="joinGroupModal">&times;</button>
            </div>
            <form id="joinGroupForm">
                <div class="form-group">
                    <label for="groupCode">Group Code</label>
                    <input type="text" id="groupCode" placeholder="Enter group code" required>
                </div>
                <button type="submit" class="btn btn-primary">Join Group</button>
            </form>
        </div>
    </div>

    <!-- Edit Group Modal -->
    <div id="editGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Group</h3>
                <button class="modal-close" data-modal="editGroupModal">&times;</button>
            </div>
            <form id="editGroupForm">
                <input type="hidden" id="editGroupId">
                <div class="form-group">
                    <label for="editGroupName">Group Name</label>
                    <input type="text" id="editGroupName" placeholder="Enter group name" required>
                </div>
                <div class="form-group">
                    <label for="editGroupDescription">Description (Optional)</label>
                    <textarea id="editGroupDescription" rows="3" placeholder="Enter group description"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Update Group</button>
            </form>
        </div>
    </div>

    <!-- Create Goal Modal -->
    <div id="createGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Goal</h3>
                <button class="modal-close" data-modal="createGoalModal">&times;</button>
            </div>
            <form id="createGoalForm">
                <div class="form-group">
                    <label for="goalTitle">Goal Title</label>
                    <input type="text" id="goalTitle" placeholder="e.g., Daily Skincare" required>
                </div>
                <div class="form-group">
                    <label for="goalDescription">Description</label>
                    <textarea id="goalDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="goalGroup">Group (Optional)</label>
                    <select id="goalGroup">
                        <option value="">Personal Goal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="goalFrequency">Frequency</label>
                    <select id="goalFrequency" required>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="goalTargetDays">Target Days</label>
                    <input type="number" id="goalTargetDays" min="1" value="30">
                </div>
                <div class="form-group">
                    <label for="goalMaxLogsPerDay">Max logs per day (per user)</label>
                    <input type="number" id="goalMaxLogsPerDay" min="1" value="1">
                </div>
                <button type="submit" class="btn btn-primary">Create Goal</button>
            </form>
        </div>
    </div>

    <!-- Log Progress Modal -->
    <div id="logProgressModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Log Progress</h3>
                <button class="modal-close" data-modal="logProgressModal">&times;</button>
            </div>
            <form id="logProgressForm">
                <input type="hidden" id="progressGoalId">
                <div class="form-group">
                    <label for="progressDate">Date</label>
                    <input type="date" id="progressDate" required>
                </div>
                <div class="form-group">
                    <label for="progressNotes">Notes (Optional)</label>
                    <textarea id="progressNotes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Log Progress</button>
            </form>
        </div>
    </div>

    <!-- View Goal Details Modal -->
    <div id="goalDetailsModal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="goalDetailsTitle"></h3>
                <button class="modal-close" data-modal="goalDetailsModal">&times;</button>
            </div>
            <div id="goalDetailsContent">
                <!-- Goal info, progress entries, comments will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Add Friend Modal -->
    <div id="addFriendModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Friend</h3>
                <button class="modal-close" data-modal="addFriendModal">&times;</button>
            </div>
            <form id="addFriendForm">
                <div class="form-group">
                    <label for="friendUsername">Friend Tag</label>
                    <input type="text" id="friendUsername" placeholder="e.g. user" required>
                    <small class="form-help-text">Share your tag (username#1234) with friends so they can add you.</small>
                </div>
                <button type="submit" class="btn btn-primary">Send Friend Request</button>
            </form>
        </div>
    </div>

    <!-- Friend Requests Modal -->
    <div id="friendRequestsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Friend Requests</h3>
                <button class="modal-close" data-modal="friendRequestsModal">&times;</button>
            </div>
            <div id="friendRequestsList">
                <p class="loading">Loading requests...</p>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="messageModal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="messageModalTitle">Messages</h3>
                <button class="modal-close" data-modal="messageModal">&times;</button>
            </div>
            <div id="messageContent" class="message-container">
                <div id="messagesList" class="messages-list"></div>
                <div class="message-input-container">
                    <input type="text" id="messageInput" placeholder="Type a message..." />
                    <button id="sendMessageBtn" class="btn btn-primary">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Group Chat Modal -->
    <div id="groupChatModal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="groupChatTitle">Group Chat</h3>
                <button class="modal-close" data-modal="groupChatModal">&times;</button>
            </div>
            <div class="message-container">
                <div id="groupMessagesList" class="messages-list"></div>
                <div class="message-input-container">
                    <input type="text" id="groupMessageInput" placeholder="Type a message..." />
                    <button id="sendGroupMessageBtn" class="btn btn-primary">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Group Analytics Modal -->
    <div id="groupAnalyticsModal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="groupAnalyticsTitle">Group Analytics</h3>
                <button class="modal-close" data-modal="groupAnalyticsModal">&times;</button>
            </div>
            <div id="groupAnalyticsContent" style="padding: 20px;">
                <p class="loading">Loading analytics...</p>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>

